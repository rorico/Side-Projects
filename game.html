<!DOCTYPE html>

<html>
<head>
    <title>Game</title>
    <style>
        ::-webkit-scrollbar { 
            display: none; 
        }
        #one{
            padding-bottom: 10px;
            color:white;
            text-align: center;
        }
        #one td{
            width:40px;
            height:40px;
            border:1px black solid;
        }
        #scores td{
            width:75px;
        }
        #one .v0{
            color: black;
        }
        #one .v1{
            background-color: #191970;
        }
        #one .v2{
            background-color: #191970;
            width:34px;
            height:34px;
            border:4px #add8e6 solid;
        }
        #one .v3{
            background-color: #6e8b3d;
        }
        #one .v4{
            background-color: #6e8b3d;
            width:34px;
            height:34px;
            border:4px black solid;
        }
        .c1{
            background-color: #191970;
            color:white;
        }
        .c3{
            background-color: #6e8b3d;
            color:white;
        }
        #card_played{
            margin-top:11px;
            margin-left:30px;
            width:61px;
            max-height:380px;
            overflow-y: auto;
            overflow-x: hidden;
            text-align:center;
        }
        #card_played div{
            height:40px;
            width:40px;
            border:1px solid black;
            display:block;
            vertical-align: middle;
            line-height: 40px;
        }
        div{
            float:left;
            display:inline-block;
        }
        #pause{
            opacity:0.5;
            background-color: white;
            font-size: 100px;
            top: 40%;
            left: 36%;
            position: fixed;
            display: none;
            border: 1px black solid;
            padding: 10px;
        }
        .players{
            float:initial;
            overflow:hidden;
            height:50px;
            display:block;
            text-align:center;
        }
        .players div{
            margin-top:8px;
            height:40px;
            width:40px;
            border:1px solid black;
            display:block;
            vertical-align: middle;
            line-height: 40px;
        }
        .players div.hide{
            color:white;
        }
        .players .raise{
            margin-top:0px;
        }
        .playerTitle{
            float:initial;
            overflow:hidden;
            height:30px;
            display:block;
            text-align:center;
            margin-top:20px;
        }
        .options{
            margin-top:50px;
            min-width: 10px;
            float:initial;
            overflow:hidden;
            height:50px;
            display:block;
            text-align:center;
        }
        .options div{
            margin-left:10px;
            margin-top:8px;
            height:40px;
            padding-left:10px;
            padding-right:10px;
            border:1px solid black;
            display:block;
            vertical-align: middle;
            line-height: 40px;
        }
        .choose{
            background-color:orange !important;
        }
    </style>
</head>
<script value="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<body>
<div id="pause">Paused</div>
<div style = "float:initial">
    <div><table id="one"></table></div>
    <div id="card_played"></div>
    <div style = "overflow:hidden;float:initial;display:block;">
        <div>
            <div class="playerTitle">Player 1</div>
            <div class="players" id="p0"></div>
            <div class="playerTitle">Player 2</div>
            <div class="players" id="p1"></div>
            <div class="playerTitle">Player 3</div>
            <div class="players" id="p2"></div>
            <div class="playerTitle">Player 4</div>
            <div class="players" id="p3"></div>
        </div>
        <div>
            <div class="options" id="o0"></div>
            <div class="options" id="o1"></div>
            <div class="options" id="o2"></div>
            <div class="options" id="o3"></div>
        </div>
    </div>
    
</div>
<div style="float:right;">
    <p>Speed(ms): <input type="text" id="speed" value="1000"></p>
    <p>Player1: Human<input name="1" value="human" type="radio">Computer<input name="1" value="computer" checked="checked" type="radio"></p>
    <p>Player2: Human<input name="2" value="human" checked="checked" type="radio">Computer<input name="2" value="computer" type="radio"></p>
    <p>Player3: Human<input name="3" value="human" type="radio">Computer<input name="3" value="computer" checked="checked" type="radio"></p>
    <p>Player4: Human<input name="4" value="human" type="radio">Computer<input name="4" value="computer" checked="checked" type="radio"></p>
</div>
<table id="scores">
    <tr>
        <td></td>
        <td>Blue</td>
        <td>Green</td>
        <td>Ties</td>
    </tr><tr>
        <td>Number</td>
        <td id="bluewin">0</td>
        <td id="greenwin">0</td>
        <td id="ties">0</td>
    </tr><tr>
        <td>Percentage</td>
        <td id="blueP">0.00%</td>
        <td id="greenP">0.00%</td>
        <td id="tieP">0.00%</td>
    </tr>
</table>
<p id="values"></p>
<script value="text/javascript">



$(document).ready(function(){
    $('input[type=radio]').on('change',function(){
        event.stopPropagation();
        if (this.value=="human") {
            human[this.name-1]=true;
        } else if (this.value=="computer") {
            human[this.name-1]=false;
        }
    });
    $('input[type=radio]').click(function(){
        event.stopPropagation();
    });
    
    var keepgoing = true;
    var maxGame = 1000;
    var gameN = 0;
    var turnN = 0;
    var pauseable = true;
    var unpauseable = false;
    $(document).click(function(){
        if (pauseable) {
            keepgoing = !keepgoing;
            if (keepgoing) {
                $('#pause').css('display','none');
                if (unpauseable) {
                    unpauseable = false;
                    start(turnN,gameN);
                }
            } else {
                $('#pause').css('display','block');
            }
        }   
    })
    
    var speed = 1000;
    $('#speed').keyup(function () {
         var thisSpeed = $(this).val();
         if (!isNaN(thisSpeed)) {
             speed = thisSpeed;
         }
     });
    var board = [];
    var deck = [];
    var greenwin = 0;
    var bluewin = 0;
    var ties = 0;
    var pointworth = [];
    
    var points = [];
    var players = [];
    var blueLines = 0;
    var greenLines = 0;
    var cardsleft = 75;
    var cardsplayed = [];
    
    var human = [false,true,false,false];

    
    initialize();
    var gameend = true;
    var animate = true;
    //noDelay();
    delayedStart(0,0);
    function start(i,j){
        if( i < 104 && greenLines<2 && blueLines<2 && keepgoing && gameend ){
            gameN=j;
            turnN=i;
            var player = i%4;
            switch (player) {
                case 0:
                    if (human[player]) {
                        pauseable = false;
                        hideHands(player);
                        playHuman(player,1);
                        return;
                    } else {
                        playBlue(player);
                    }
                    break;
                case 1:
                    if (human[player]) {
                        pauseable = false;
                        hideHands(player);
                        playHuman(player,3);
                        return;
                    } else {
                        playGreen(player);
                    }
                    break;
                case 2:
                    if (human[player]) {
                        pauseable = false;
                        hideHands(player);
                        playHuman(player,1);
                        return;
                    } else {
                        playBlue(player);
                    }
                    break;
                case 3:
                    if (human[player]) {
                        pauseable = false;
                        hideHands(player);
                        playHuman(player,3);
                        return;
                    } else {
                        playGreen(player);
                    }
                    break;
            }
            delayedStart(i+1,j);
        } else if (!keepgoing) {
            gameN=j;
            turnN=i;
            unpauseable = true;
            $('#pause').css('display','block');
        } else if(!gameend){
            gameend=true;
            restart();
            delayedStart(0,j+1);
        } else {
            if(greenLines>=2){
                greenwin++;
            } else if (blueLines>=2){
                bluewin++;
            } else {
                ties++;
            }
            gameN=j;
            turnN=i;
            console.log(j);
            $('#bluewin').text(bluewin);
            $('#greenwin').text(greenwin);
            $('#ties').text(ties);
            $('#blueP').text(((bluewin/(j+1))*100).toFixed(2)+"%");
            $('#greenP').text(((greenwin/(j+1))*100).toFixed(2)+"%");
            $('#tieP').text(((ties/(j+1))*100).toFixed(2)+"%");
            
            if (j<maxGame) {
                setTimeout(function(){
                    gameend=false;
                    start(i,j);
                },speed*3);
            } else {
                pauseable = false;
                showWorth();
            }
        }
    }

    function delayedStart(i,j) {
        if (speed==0) {
            start(i,j);
        } else {
            setTimeout(function(){
                start(i,j);
            },speed);
        }
    }
    
    function noDelay() {
        animate = false;
        for (var j = 0 ; j < maxGame ; j++) {
            for( var i = 0 ; i < 104 && greenLines<2 && blueLines<2 && keepgoing && gameend ; i++){
                switch (i%4) {
                    case 0:
                        playBlue(0);
                        break;
                    case 1:
                        playGreen(1);
                        break;
                    case 2:
                        playBlue(2);
                        break;
                    case 3:
                        playGreen(3);
                        break;
                }
            }
            if(greenLines>=2){
                greenwin++;
            } else if (blueLines>=2){
                bluewin++;
            } else {
                ties++;
            }
            gameN=j;
            turnN=i;
            $('#bluewin').text(bluewin);
            $('#greenwin').text(greenwin);
            $('#ties').text(ties);
            $('#blueP').text(((bluewin/(j+1))*100).toFixed(2)+"%");
            $('#greenP').text(((greenwin/(j+1))*100).toFixed(2)+"%");
            $('#tieP').text(((ties/(j+1))*100).toFixed(2)+"%");
            restart();
        }
        showWorth();
    }
    
    
    function initialize()
    {
        //creates indexes for rows 1 - 5
        for (var row = 0 ; row < 5 ; row++) {
            var rowinfo = [];
            var pointsrow = [];
            var pointworthrow = [];
            for( var col = 1 ; col<=10 ; col++)
            {
                if (row==0) {
                    if (col==1||col==10) {
                        
                        rowinfo.push(1);
                        pointsrow.push(0);
                        pointworthrow.push(0);
                    } else {
                        rowinfo.push(col);
                        pointsrow.push(0);
                        pointworthrow.push(0);
                    }
                    continue;
                } else {
                    rowinfo.push(col+10*row-1);
                    pointsrow.push(0);
                    pointworthrow.push(0);
                }
            }
            board.push(rowinfo);
            points.push(pointsrow);
            pointworth.push(pointworthrow);
        }

        //copies a reverse of rows 1 - 5
        for (var i = 0 ; i < 5 ; i++)
        {
            board.push(board[4-i].slice().reverse());
            points.push(points[4-i].slice());
            pointworth.push(pointworth[4-i].slice());
        }
        for (var i = 2 ; i < 50 ; i++)
        {
            deck.push(i);
            deck.push(i);
        }
        for (var i = 0 ; i < 4 ; i++)
        {
            deck.push(1);
        }
        for (var i = 0 ; i < 2 ; i++)
        {
            deck.push(0);
            deck.push(-1);
        }
        shuffle(deck);
     
        //create deck //deal deck
        var player1 = [];
        var player2 = [];
        var player3 = [];
        var player4 = [];
        for (var i = 97 ; i < 104 ; i++)
        {
            player1.push(deck[i]);
        }
        for (var i = 90 ; i < 97 ; i++)
        {
            player2.push(deck[i]);
        }
        for (var i = 83 ; i < 90 ; i++)
        {
            player3.push(deck[i]);
        }
        for (var i = 76 ; i < 83 ; i++)
        {
            player4.push(deck[i]);
        }
        players = [player1.slice(),player2.slice(),player3.slice(),player4.slice()];
        showHands();
        
            var cnt = 1;
            for(var i = 0 ; i<board.length ; i++)
            {
                $('#one').append('<tr id =one'+i+'></tr>');
                for(var j = 0 ; j<board[i].length ; j++)
                {
                    $('#one'+i).append('<td class="v'+points[i][j]+'" id="'+cnt+'">'+changeToCards(board[i][j])+'</td>');
                    cnt++;
                }
            }
    }

    //game play
    function playHuman(player,value) {
        for (var i = 0 ; i<players[player].length ; i++) {
            $('#p'+player+'_'+i).addClass('choose');
            $('#p'+player+'_'+i).bind('click',{player:player,i:i,value:value}, function(event) {
                chooseCard(event.data.player,event.data.i,event.data.value);
            });
        }
        var options = getOptions(players[player]);
        for (var card = 0 ; card<options.length ; card++) {
            for (var side = 0 ; options[card]!=-1&&options[card]!=0&&side<options[card].length ; side++) {
                var x = options[card][side][0];
                var y = options[card][side][1];
                showChoose(player,x,y,value,card);
            }
        }
    }
    function chooseCard(player,card,value) {
        event.stopPropagation();
        $('.choose').unbind('click');
        $('.choose').removeClass('choose');
        $('#o'+player).append("<div class='choose option' id='back'>BACK</div>");
        $('#back').bind('click',{player:player,value:value}, function(event) {
            $('.option').remove();
            $('.choose').unbind('click');
            $('.choose').removeClass('choose');
            playHuman(event.data.player,event.data.value);
        });
        options = getOptions([players[player][card]]);
        if (options[0]==0) {
            var options = [];
            options.push(addJR());
        }
        if (options[0]==-1) {
            var options = [];
            options.push(removeJR(value));
            for (var side = 0 ; side<options[0].length ; side++) {
                var x = options[0][side][0];
                var y = options[0][side][1];
                showChooseRemove(player,x,y,value,card);
            }
            return;
        }
        if (options[0].length==0) {
            $('#o'+player).append("<div class='choose option' id='remove'>REMOVE</div>");
            $('#remove').bind('click',{player:player,value:value,card:card}, function(event) {
                $('.option').remove();
                $('.choose').unbind('click');
                $('.choose').removeClass('choose');
                afterplay(event.data.player,event.data.card,event.data.value,true);
                playHuman(event.data.player,event.data.value);
            });
        }
        for (var side = 0 ; side<options[0].length ; side++) {
            var x = options[0][side][0];
            var y = options[0][side][1];
            showChoose(player,x,y,value,card);
        }
    }
    function showChoose(player,x,y,value,card) {
        var position = 10*x+y+1;
        if (animate) {
            $('#'+position).addClass('choose');
        }
        $('#'+position).bind('click',{player:player,x:x,y:y,value:value,card:card}, function(event) {
            event.stopPropagation();
            $('.choose').unbind('click');
            $('.choose').removeClass('choose');
            $('.option').remove();
            chooseSide(event.data.player,event.data.x,event.data.y,event.data.value,event.data.card);
        });
    }
    function chooseSide(player,x,y,value,card) {
        changeValue(x,y,value);
        checker(x,y);
        afterplay(player,card,value);
        $('.hide').removeClass('hide');
        pauseable = true;
        delayedStart(turnN+1,gameN);
    }
    function showChooseRemove(player,x,y,value,card) {
        var position = 10*x+y+1;
        if (animate) {
            $('#'+position).addClass('choose');
        }
        $('#'+position).bind('click',{player:player,x:x,y:y,value:value,card:card}, function(event) {
            event.stopPropagation();
            $('.choose').unbind('click');
            $('.choose').removeClass('choose');
            $('.option').remove();
            chooseSideRemove(event.data.player,event.data.x,event.data.y,event.data.value,event.data.card);
        });
    }
    function chooseSideRemove(player,x,y,value,card) {
        value0(x,y);
        afterplay(player,card,value);
        $('.hide').removeClass('hide');
        pauseable = true;
        delayedStart(turnN+1,gameN);
    }

    //game play
    function playBlue (player){
        playAI(player,1,true);
    }
    function playGreen (player){
        playAI(player,3,true);
    }
    function playHybrid (player,value){
        if (value===3) {
            if (greenLines==1) {
                playAI(player,value,true);
            } else {
                playAI(player,value,false);
            }
        } else if (value===1) {
            if (blueLines==1) {
                playAI(player,value,true);
            } else {
                playAI(player,value,false);
            }
        }
    }
    
    function play(player,value){
        if (players[player].length==0) {
            return;
        }
        var options = getOptions(players[player]);
        var card = Math.floor(Math.random()*options.length);
        if (options[card].length!=0) {
            if (options[card]==0){
                options = addJR();
                var side = Math.floor(Math.random()*options.length);
                var x = options[side][0];
                var y = options[side][1];
                changeValue(x,y,value);
                checker(x,y);
                afterplay(player,card,value);
            } else if(options[card]==-1) {
                options = removeJR(value);
                if (options.length==0) {
                    play(player,value);
                    return;
                }
                var side = Math.floor(Math.random()*options.length);
                var x = options[side][0];
                var y = options[side][1];
                value0(x,y);
                afterplay(player,card,value);
            } else {
                var side = Math.floor(Math.random()*options[card].length);
                var x = options[card][side][0];
                var y = options[card][side][1];
                changeValue(x,y,value);
                checker(x,y);
                afterplay(player,card,value);
            }
        } else {
            afterplay(player,card,value,true);
            play(player,value);
        }
    }
    
    function playAI(player,value,offensive) {
        if (players[player].length==0) {
            return;
        }
        var options = getOptions(players[player]);
        var useless = hasUselessCard(options);
        if (useless!==false) {
            afterplay(player,useless,value,true);
            playAI(player,value,offensive);
            return;
        }
        var best = mostLines(options,value,offensive);
        if (best[0]!=4) {
            var removePos = hasRemove(players[player]);
            if (removePos!=-1) {
                var options2 = removeJ(value);
                if (options2.length!=0) {
                    var side = Math.floor(Math.random()*options2.length);
                    var x = options2[side][0];
                    var y = options2[side][1];
                    points[x][y] = 0;
                    value0(x,y);
                    afterplay(player,removePos,value);
                    return;
                }  else if (hasOnlyRemoveJ(players[player])){
                    options = removeJR(value);
                    var side = Math.floor(Math.random()*options.length);
                    var x = options[side][0];
                    var y = options[side][1];
                    points[x][y] = 0;
                    value0(x,y);
                    afterplay(player,removePos,value);
                    return;
                }
            }
            var addPos = hasAdd(players[player]);
            if (addPos!=-1) {
                var options2 = addJ(value,offensive);
                if (options2.length!=0) {
                    var side = Math.floor(Math.random()*options2.length);
                    var x = options2[side][0];
                    var y = options2[side][1];
                    changeValue(x,y,value);
                    checker(x,y);
                    afterplay(player,addPos,value);
                    return;
                } else if (hasOnlyJ(players[player])){
                    options = addJR();
                    var side = Math.floor(Math.random()*options.length);
                    var x = options[side][0];
                    var y = options[side][1];
                    changeValue(x,y,value);
                    checker(x,y);
                    afterplay(player,addPos,value);
                    return;
                }
            }
        }
        var random = Math.floor(Math.random()*best[1].length);
        var card = best[1][random][0];
        var side = best[1][random][1];
        var x = options[card][side][0];
        var y = options[card][side][1];
        changeValue(x,y,value);
        checker(x,y);
        afterplay(player,card,value);
    }
    function playSides(player,value,offensive) {
        if (players[player].length==0) {
            return;
        }
        var options = getOptions(players[player]);
        var useless = hasUselessCard(options);
        if (useless!==false) {
            afterplay(player,useless,value,true);
            playSides(player,value,offensive);
            return;
        }
        var best = mostLines(options,value,offensive);
        if (best[0]!=4) {
            var removePos = hasRemove(players[player]);
            if (removePos!=-1) {
                var options2 = removeJ(value);
                if (options2.length!=0) {
                    var side = Math.floor(Math.random()*options2.length);
                    var x = options2[side][0];
                    var y = options2[side][1];
                    points[x][y] = 0;
                    value0(x,y);
                    afterplay(player,removePos,value);
                    return;
                }  else if (hasOnlyRemoveJ(players[player])){
                    options = removeJR(value);
                    var side = Math.floor(Math.random()*options.length);
                    var x = options[side][0];
                    var y = options[side][1];
                    points[x][y] = 0;
                    value0(x,y);
                    afterplay(player,removePos,value);
                    return;
                }
            }
            var addPos = hasAdd(players[player]);
            if (addPos!=-1) {
                var options2 = addJ(value,offensive);
                if (options2.length!=0) {
                    var side = Math.floor(Math.random()*options2.length);
                    var x = options2[side][0];
                    var y = options2[side][1];
                    changeValue(x,y,value);
                    checker(x,y);
                    afterplay(player,addPos,value);
                    return;
                } else if (hasOnlyJ(players[player])){
                    options = addJR();
                    var side = Math.floor(Math.random()*options.length);
                    var x = options[side][0];
                    var y = options[side][1];
                    changeValue(x,y,value);
                    checker(x,y);
                    afterplay(player,addPos,value);
                    return;
                }
            }
        }
        if (best[0]<=3) {
            var bestCard = -1;
            var bestAmount = 0;
            var side = -1;
            for( var i = 0 ; i<options.length ; i++ ){
                var sideInfo = bestSide(options[i],value,offensive);
                if (bestAmount<sideInfo[0]) {
                    bestCard = i;
                    bestAmount = sideInfo[0];
                    side = sideInfo[1];
                }
                
            }
            if (bestCard === -1) {
            } else {
                var x = options[bestCard][side][0];
                var y = options[bestCard][side][1];
                changeValue(x,y,value);
                checker(x,y);
                afterplay(player,bestCard,value);
                return;
            }
        }
        var random = Math.floor(Math.random()*best[1].length);
        var card = best[1][random][0];
        var side = best[1][random][1];
        var x = options[card][side][0];
        var y = options[card][side][1];
        changeValue(x,y,value);
        checker(x,y);
        afterplay(player,card,value);
    }
    function playWorth(player,value,offensive) {
        if (players[player].length==0) {
            return;
        }
        
        var worth = [[58,64,77,91,128,129,82,77,72,55],[76,84,96,137,162,133,106,92,95,56],[87,98,126,155,193,184,147,147,113,84],[93,128,149,158,196,215,187,152,135,95],[130,151,169,190,234,248,222,172,150,127],[118,145,178,220,255,248,211,175,147,130],[87,124,154,209,238,226,181,161,123,100],[68,94,124,166,178,191,178,151,98,88],[62,90,94,112,133,157,129,104,82,64],[50,61,60,78,102,113,86,85,57,50]];
        var options = getOptions(players[player]);
        var useless = hasUselessCard(options);
        if (useless!==false) {
            afterplay(player,useless,value,true);
            playSides(player,value,offensive);
            return;
        }
        var removePos = hasRemove(players[player]);
        if (removePos!=-1) {
            var options2 = removeJ(value);
            if (options2.length!=0) {
                var side = Math.floor(Math.random()*options2.length);
                var x = options2[side][0];
                var y = options2[side][1];
                points[x][y] = 0;
                value0(x,y);
                afterplay(player,removePos,value);
                return;
            }  else if (hasOnlyRemoveJ(players[player])){
                options = removeJR(value);
                var side = Math.floor(Math.random()*options.length);
                var x = options[side][0];
                var y = options[side][1];
                points[x][y] = 0;
                value0(x,y);
                afterplay(player,removePos,value);
                return;
            }
        }
        var addPos = hasAdd(players[player]);
        if (addPos!=-1) {
            var options2 = addJ(value,offensive);
            if (options2.length!=0) {
                var side = Math.floor(Math.random()*options2.length);
                var x = options2[side][0];
                var y = options2[side][1];
                changeValue(x,y,value);
                checker(x,y);
                afterplay(player,addPos,value);
                return;
            } else if (hasOnlyJ(players[player])){
                options = addJR();
                var side = Math.floor(Math.random()*options.length);
                var x = options[side][0];
                var y = options[side][1];
                changeValue(x,y,value);
                checker(x,y);
                afterplay(player,addPos,value);
                return;
            }
        }
        var max = 0;
        var maxCard = -1;
        var maxSide = -1;
        for (var i = 0 ; i < options.length ; i++) {
            for (var j = 0 ; j < options[i].length ; j++) {
                if (options[i][j]==0||options[i][j]==-1) {
                    continue;
                }
                if (worth[options[i][j][0]][options[i][j][1]] > max) {
                    max = worth[options[i][j][0]][options[i][j][1]];
                    maxCard = i;
                    maxSide = j;
                }
            }
        }
        var x = options[maxCard][maxSide][0];
        var y = options[maxCard][maxSide][1];
        changeValue(x,y,value);
        checker(x,y);
        afterplay(player,maxCard,value);
    }

    //array of options that player can play
    function getOptions(player){
        var options = [];
        for( var k = 0 ; k<player.length ; k++ )
        {
            var options1 = [];
            if (player[k]==0||player[k]==-1) {
                options1.push(player[k]);
            } else {
                for( var i = 0 ; i<board.length ; i++ )
                {
                    for( var j = 0 ; j<board[i].length ; j++ )
                    {
                        if (board[i][j]==player[k]&&points[i][j]==0) {
                            options1.push([i,j]);
                        }
                    }
                }
            }
            options.push(options1);
        }
        return options;
    }

    //pick up new card
    function afterplay(player,index,value,change) {
        if (animate) {
            $("#card_played").prepend("<div class='c"+value+"'>"+changeToCards(players[player][index])+"</div>");
        }
        cardsplayed.push(players[player][index]);
        if (cardsleft!=-1) {
            players[player][index] = deck[cardsleft];
            cardsleft--;
            if (animate) {
                animateHand(index,player,false,change);
            }
        } else {
            players[player].splice(index,1);
            if (animate) {
                animateHand(index,player,true,change);
            }
        }
    }

    //random add jack
    function addJR (){
        var options = [];
        for( var i = 0 ; i<board.length ; i++ )
        {
            for( var j = 0 ; j<board[i].length ; j++ )
            {
                if (points[i][j]==0) {
                    options.push([i,j]);
                }
            }
        }
        return options;
    }

    //random remove jack 
    function removeJR(colour){
        if (colour==1) {
            colour=3;
        } else if (colour==3) {
            colour=1;
        }
        var options = [];
        for( var i = 0 ; i<board.length ; i++ )
        {
            for( var j = 0 ; j<board[i].length ; j++ )
            {
                if (points[i][j]==colour) {
                    options.push([i,j]);
                }
            }
        }
        return options;
    }

    //add jack
    function addJ (colour,offensive){
        var value = 4-colour;
        var tnp = [];
        var returnValues = [];
        
        for ( var times = 0 ; times <=1 ; times++) {
            value=4-value;
            if (value!=colour&&offensive) {
                continue;
            }
            var checkOpen = 0;
            var cnt11 = 0;
            var cnt12 = 0;
            var cnt13 = 0;
            var cnt21 = 0;
            for (var row = 0 ; row<10 ; row++){
                checkOpen = 0;
                cnt21=0;
                for(var i = 0 ; i < 5 ; i++) {
                    if (points[row][i]==value) {
                        cnt21++;
                    } else if (points[row][i]!=0) {
                        checkOpen++;
                    } else {
                        tnp=[row,i];
                    }
                }
                if (cnt21==4&&checkOpen==0) {
                    returnValues.push(tnp.slice());
                }
                for (var col = 0 ; col<5 ; col++) {
                    if (points[row][col]==value) {
                        cnt21--;
                    } else if (points[row][col]!=0) {
                        checkOpen--;
                    }
                    if (points[row][col+5]==value) {
                        cnt21++;
                    } else if (points[row][col+5]!=0) {
                        checkOpen++;
                    } else {
                        tnp = [row,col+5];
                    }
                    if (cnt21==4&&checkOpen==0) {
                        returnValues.push(tnp.slice());
                    }
                }
            }
            for (var col = 0 ; col<10 ; col++){
                checkOpen = 0;
                cnt12=0;
                for(var i = 0 ; i < 5 ; i++) {
                    if (points[i][col]==value) {
                        cnt12++;
                    } else if (points[i][col]!=0) {
                        checkOpen++;
                    } else {
                        tnp=[i,col];
                    }
                }
                if (cnt12==4&&checkOpen==0) {
                    returnValues.push(tnp.slice());
                }
                for (var row = 0 ; row<5 ; row++) {
                    if (points[row][col]==value) {
                        cnt12--;
                    } else if (points[row][col]!=0) {
                        checkOpen--;
                    }
                    if (points[row+5][col]==value) {
                        cnt12++;
                    } else if (points[row+5][col]!=0) {
                        checkOpen++;
                    } else {
                        tnp = [row+5,col];
                    }
                    if (cnt12==4&&checkOpen==0) {
                        returnValues.push(tnp.slice());
                    }
                }
            }
            for (var row = 0 ; row<6 ; row++){
                checkOpen = 0;
                cnt11=0;
                for(var i = 0 ; i < 5 ; i++) {
                    if (points[row+i][i]==value) {
                        cnt11++;
                    } else if (points[row+i][i]!=0) {
                        checkOpen++;
                    } else {
                        tnp=[row+i,i];
                    }
                }
                if (cnt11==4&&checkOpen==0) {
                    returnValues.push(tnp.slice());
                }
                for (var col = 0 ; col<5-row ; col++) {
                    if (points[row+col][col]==value) {
                        cnt11--;
                    } else if (points[row+col][col]!=0) {
                        checkOpen--;
                    }
                    if (points[row+5+col][col+5]==value) {
                        cnt11++;
                    } else if (points[row+5+col][col+5]!=0) {
                        checkOpen++;
                    } else {
                        tnp = [row+5+col,col+5];
                    }
                    if (cnt11==4&&checkOpen==0) {
                        returnValues.push(tnp.slice());
                    }
                }
            }
            for (var col = 1 ; col<6 ; col++){
                checkOpen = 0;
                cnt11=0;
                for(var i = 0 ; i < 5 ; i++) {
                    if (points[i][col+i]==value) {
                        cnt11++;
                    } else if (points[i][col+i]!=0) {
                        checkOpen++;
                    } else {
                        tnp=[i,col+i];
                    }
                }
                if (cnt11==4&&checkOpen==0) {
                    returnValues.push(tnp.slice());
                }
                for (var row = 0 ; row<5-col ; row++) {
                    if (points[row][col+row]==value) {
                        cnt11--;
                    } else if (points[row][col+row]!=0) {
                        checkOpen--;
                    }
                    if (points[row+5][col+5+row]==value) {
                        cnt11++;
                    } else if (points[row+5][col+5+row]!=0) {
                        checkOpen++;
                    } else {
                        tnp = [row+5,col+5+row];
                    }
                    if (cnt11==4&&checkOpen==0) {
                        returnValues.push(tnp.slice());
                    }
                }
            }
            for (var row = 4 ; row<10 ; row++){
                checkOpen = 0;
                cnt11=0;
                for(var i = 0 ; i < 5 ; i++) {
                    if (points[row-i][i]==value) {
                        cnt11++;
                    } else if (points[row-i][i]!=0) {
                        checkOpen++;
                    } else {
                        tnp=[row-i,i];
                    }
                }
                if (cnt11==4&&checkOpen==0) {
                    returnValues.push(tnp.slice());
                }
                for (var col = 0 ; col<row-4 ; col++) {
                    if (points[row-col][col]==value) {
                        cnt11--;
                    } else if (points[row-col][col]!=0) {
                        checkOpen--;
                    }
                    if (points[row-5-col][col+5]==value) {
                        cnt11++;
                    } else if (points[row-5-col][col+5]!=0) {
                        checkOpen++;
                    } else {
                        tnp = [row-5-col,col+5];
                    }
                    if (cnt11==4&&checkOpen==0) {
                        returnValues.push(tnp.slice());
                    }
                }
            }
            for (var col = 1 ; col<6 ; col++){
                checkOpen = 0;
                cnt11=0;
                for(var i = 0 ; i < 5 ; i++) {
                    if (points[9-i][col+i]==value) {
                        cnt11++;
                    } else if (points[9-i][col+i]!=0) {
                        checkOpen++;
                    } else {
                        tnp=[9-i,col+i];
                    }
                }
                if (cnt11==4&&checkOpen==0) {
                    returnValues.push(tnp.slice());
                }
                for (var row = 0 ; row<5-col ; row++) {
                    if (points[9-row][col+row]==value) {
                        cnt11--;
                    } else if (points[9-row][col+row]!=0) {
                        checkOpen--;
                    }
                    if (points[4-row][col+5+row]==value) {
                        cnt11++;
                    } else if (points[4-row][col+5+row]!=0) {
                        checkOpen++;
                    } else {
                        tnp = [4-row,col+5+row];
                    }
                    if (cnt11==4&&checkOpen==0) {
                        returnValues.push(tnp.slice());
                    }
                }
            }
        }
        if (returnValues.length!=0) {
            returnValues.sort(sort_arrays);
            var returnValues2 = [];
            var current = [,];
            var cnt = 0;
            for (var i = 0; i < returnValues.length; i++) {
                if (returnValues[i][0] != current[0]||returnValues[i][1] != current[1]) {
                    if (cnt > 0) {
                        returnValues2.push(current.slice());
                        returnValues2[returnValues2.length-1].push(cnt);
                    }
                    current = returnValues[i].slice();
                    cnt = 1;
                } else {
                    cnt++;
                }
            }
            if (cnt > 0) {
                returnValues2.push(current.slice());
                returnValues2[returnValues2.length-1].push(cnt);
            }
            var returnValues3=[];
            returnValues2.sort(sort_by_number);
            max = returnValues2[0][2];
            for (var i = 0 ; i < returnValues2.length ; i++){
                if (returnValues2[i][2]==max) {
                    returnValues3.push(returnValues2[i].slice());
                }else {
                    break;
                }
            }
            return returnValues3;
        } else {
            return [];
        }
    }

    //add jack v2
    function addJ_2 (colour){
        var options = check4_2(colour);
        return options;
    }

    //remove jack 
    function removeJ(colour){
        if (colour==1) {
            colour=3;
        } else if (colour==3) {
            colour=1;
        }
        
        var worth = [];
        for( var i = 0 ; i<board.length ; i++ ){
            var worthrow = [];
            for( var j = 0 ; j<board[i].length ; j++ ){
                worthrow.push(0);
                
            }
            worth.push(worthrow);
        } 
        var value = colour;
        var tnp = [];
        
        var check = true;
        var cnt11 = 0;
        var cnt12 = 0;
        var cnt13 = 0;
        var cnt21 = 0;
        for (var row = 0 ; row<10 ; row++){
            check = true;
            tnp=[];
            cnt21=0;
            for(var i = 0 ; i < 5 ; i++) {
                if (points[row][i]==value) {
                    cnt21++;
                    tnp.push([row,i])
                } else if (points[row][i]!=0) {
                    check=false;
                }
            }
            if (cnt21==4&&check) {
                for(var i = 0 ; i<tnp.length ; i++){
                    worth[tnp[i][0]][tnp[i][1]]++;
                }
            }
            for (var col = 0 ; col<5 ; col++) {
                if (points[row][col]==value) {
                    tnp.splice(0,1);
                    cnt21--;
                } else if (points[row][col]!=0){
                    check=true;
                }
                if (points[row][col+5]==value) {
                    cnt21++;
                    tnp.push([row,col+5]);
                } else if (points[row][col+5]!=0) {
                    check=false;
                }
                if (cnt21==4&&check) {
                    for(var i = 0 ; i<tnp.length ; i++){
                        worth[tnp[i][0]][tnp[i][1]]++;
                    }
                }
            }
        }
        for (var col = 0 ; col<10 ; col++){
            check = true;
            tnp=[];
            cnt12=0;
            for(var i = 0 ; i < 5 ; i++) {
                if (points[i][col]==value) {
                    cnt12++;
                    tnp.push([i,col]);
                } else if (points[i][col]!=0) {
                    check=false;
                }
            }
            if (cnt12==4&&check) {
                for(var i = 0 ; i<tnp.length ; i++){
                    worth[tnp[i][0]][tnp[i][1]]++;
                }
            }
            for (var row = 0 ; row<5 ; row++) {
                if (points[row][col]==value) {
                    tnp.splice(0,1);
                    cnt12--;
                } else if (points[row][col]!=0) {
                    check=true;
                }
                if (points[row+5][col]==value) {
                    cnt12++;
                    tnp.push([row+5,col]);
                } else if (points[row+5][col]!=0) {
                    check=false;
                }
                if (cnt12==4&&check) {
                    for(var i = 0 ; i<tnp.length ; i++){
                        worth[tnp[i][0]][tnp[i][1]]++;
                    }
                }
            }
        }
        for (var row = 0 ; row<6 ; row++){
            check = true;
            cnt11=0;
            for(var i = 0 ; i < 5 ; i++) {
                if (points[row+i][i]==value) {
                    cnt11++;
                    tnp.push([row+i,i]);
                } else if (points[row+i][i]!=0) {
                    check=false;
                }
            }
            if (cnt11==4&&check) {
                for(var i = 0 ; i<tnp.length ; i++){
                    worth[tnp[i][0]][tnp[i][1]]++;
                }
            }
            for (var col = 0 ; col<5-row ; col++) {
                if (points[row+col][col]==value) {
                    tnp.splice(0,1);
                    cnt11--;
                } else if (points[row+col][col]!=0) {
                    check=true;
                }
                if (points[row+5+col][col+5]==value) {
                    cnt11++;
                    tnp.push([row+5+col,col+5]);
                } else if (points[row+5+col][col+5]!=0) {
                    check=false;
                }
                if (cnt11==4&&check) {
                    for(var i = 0 ; i<tnp.length ; i++){
                        worth[tnp[i][0]][tnp[i][1]]++;
                    }
                }
            }
        }
        for (var col = 1 ; col<6 ; col++){
            check = true;
            tnp=[];
            cnt11=0;
            for(var i = 0 ; i < 5 ; i++) {
                if (points[i][col+i]==value) {
                    cnt11++;
                    tnp.push([i,col+i]);
                } else if (points[i][col+i]!=0) {
                    check=false;
                }
            }
            if (cnt11==4&&check) {
                for(var i = 0 ; i<tnp.length ; i++){
                    worth[tnp[i][0]][tnp[i][1]]++;
                }
            }
            for (var row = 0 ; row<5-col ; row++) {
                if (points[row][col+row]==value) {
                    tnp.splice(0,1);
                    cnt11--;
                } else if (points[row][col+row]!=0) {
                    check=true;
                }
                if (points[row+5][col+5+row]==value) {
                    cnt11++;
                    tnp.push([row+5,col+5+row]);
                } else if (points[row+5][col+5+row]!=0) {
                    check=false;
                }
                if (cnt11==4&&check) {
                    for(var i = 0 ; i<tnp.length ; i++){
                        worth[tnp[i][0]][tnp[i][1]]++;
                    }
                }
            }
        }
        for (var row = 4 ; row<10 ; row++){
            check = true;
            tnp=[];
            cnt11=0;
            for(var i = 0 ; i < 5 ; i++) {
                if (points[row-i][i]==value) {
                    cnt11++;
                    tnp.push([row-i,i]);
                } else if (points[row-i][i]!=0) {
                    check=false;
                }
            }
            if (cnt11==4&&check) {
                for(var i = 0 ; i<tnp.length ; i++){
                    worth[tnp[i][0]][tnp[i][1]]++;
                }
            }
            for (var col = 0 ; col<row-4 ; col++) {
                if (points[row-col][col]==value) {
                    tnp.splice(0,1);
                    cnt11--;
                } else if (points[row-col][col]!=0) {
                    check=true;
                }
                if (points[row-5-col][col+5]==value) {
                    cnt11++;
                    tnp.push([row-5-col,col+5]);
                } else if (points[row-5-col][col+5]!=0) {
                    check=false;
                }
                if (cnt11==4&&check) {
                    for(var i = 0 ; i<tnp.length ; i++){
                        worth[tnp[i][0]][tnp[i][1]]++;
                    }
                }
            }
        }
        for (var col = 1 ; col<6 ; col++){
            check = true;
            tnp=[];
            cnt11=0;
            for(var i = 0 ; i < 5 ; i++) {
                if (points[9-i][col+i]==value) {
                    cnt11++;
                    tnp.push([9-i,col+i]);
                } else if (points[9-i][col+i]!=0) {
                    check=false;
                }
            }
            if (cnt11==4&&check) {
                for(var i = 0 ; i<tnp.length ; i++){
                    worth[tnp[i][0]][tnp[i][1]]++;
                }
            }
            for (var row = 0 ; row<5-col ; row++) {
                if (points[9-row][col+row]==value) {
                    tnp.splice(0,1);
                    cnt11--;
                } else if (points[9-row][col+row]!=0) {
                    check=true;
                }
                if (points[4-row][col+5+row]==value) {
                    cnt11++;
                    tnp.push([4-row,col+5+row]);
                } else if (points[4-row][col+5+row]!=0) {
                    check=false;
                }
                if (cnt11==4&&check) {
                    for(var i = 0 ; i<tnp.length ; i++){
                        worth[tnp[i][0]][tnp[i][1]]++;
                    }
                }
            }
        }
        var returnValues = [];
        var max = 0;
        for( var i = 0 ; i<board.length ; i++ ){
            for( var j = 0 ; j<board[i].length ; j++ ){
                if (max<worth[i][j]) {
                    max = worth[i][j];
                }
            }
        }
        if (max!=0) {
            for( var i = 0 ; i<board.length ; i++ ){
                for( var j = 0 ; j<board[i].length ; j++ ){
                    if (max==worth[i][j]) {
                        returnValues.push([i,j]);
                    }
                }
            }
        }
        return returnValues;
        
    }
    
    //returns indexes for options with greatest value
    function mostLines(options,value,offensive){
        var type = value;
        var number = 4;
        var worth = [];
        for(var i = 0 ; i<options.length ; i++){
            var worthrow = [];
            if (options[i]==-1||options[i]==0) {
                worthrow.push(-1);
            } else {
                for (var j = 0 ; j<options[i].length ; j++) {
                    worthrow.push(0);
                }
            }
            worth.push(worthrow);
        }
        var breakopen = true;
        while(number!=-1&&breakopen){
            for(var option = 0; option<options.length&&breakopen ; option++){
                if (options[option]==-1||options[option]==0) {
                    continue;
                }
                for( var blah = 0 ; blah<=1&&breakopen; blah++){
                if (blah===0) {
                    type = value;
                } else if (offensive||number<3) {
                    continue;
                } else if (!offensive) {
                    type=4-value;
                }
                for(var option2 = 0; option2<options[option].length ; option2++){
                    var x = options[option][option2][0];
                    var y = options[option][option2][1];
                    
                    var check = false;
                    
                    var checkOpen = 0;
                    var checkremove = true;
                    var removed = 0;
                    var cnt = 0;
                    
                    for(var i = 1 ; i < 5 ; i++) { //11
                        if (x-i!=-1 && y-i!=-1){
                            if(points[x-i][y-i]==type) {
                                cnt++;
                            } else if(points[x-i][y-i]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (x+i!=10 && y+i!=10){
                            if(points[x+i][y+i]==type) {
                                cnt++;
                            } else if(points[x+i][y+i]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[option][option2]+=number*number;
                    }
                    for(var i = removed ; i<5 && x+i!=10 && y+i!=10 && checkremove ; i++){
                        if (points[x+i-4][y+i-4]==type) {
                            cnt--;
                        } else if (points[x+i-4][y+i-4]!=0){
                            checkOpen--;
                        }
                        if (points[x+i][y+i]==type) {
                            cnt++;
                        } else if (points[x+i][y+i]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[option][option2]+=number*number;
                        }
                    }
                    
                    checkOpen = 0;
                    removed = 0;
                    cnt = 0;
                    for(var i = 1 ; i < 5 ; i++) { //12
                        if (x-i!=-1){
                            if(points[x-i][y]==type) {
                                cnt++;
                            } else if(points[x-i][y]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (x+i!=10){
                            if(points[x+i][y]==type) {
                                cnt++;
                            } else if(points[x+i][y]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[option][option2]+=number*number;
                    }
                    for(var i = removed ; i<5 && x+i!=10 && checkremove ; i++){
                        if (points[x+i-4][y]==type) {
                            cnt--;
                        } else if (points[x+i-4][y]!=0){
                            checkOpen--;
                        }
                        if (points[x+i][y]==type) {
                            cnt++;
                        } else if (points[x+i][y]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[option][option2]+=number*number;
                        }
                    }
                    
                    checkOpen = 0;
                    removed = 0;
                    cnt = 0;
                    for(var i = 1 ; i < 5 ; i++) { //11
                        if (x-i!=-1 && y+i!=10){
                            if(points[x-i][y+i]==type) {
                                cnt++;
                            } else if(points[x-i][y+i]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (x+i!=10 && y-i!=-1){
                            if(points[x+i][y-i]==type) {
                                cnt++;
                            } else if(points[x+i][y-i]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[option][option2]+=number*number;
                    }
                    for(var i = removed ; i<5 && x+i!=10 && y-i!=-1 && checkremove ; i++){
                        if (points[x+i-4][y-i+4]==type) {
                            cnt--;
                        } else if (points[x+i-4][y-i+4]!=0){
                            checkOpen--;
                        }
                        if (points[x+i][y+i]==type) {
                            cnt++;
                        } else if (points[x+i][y-i]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[option][option2]+=number*number;
                        }
                    }
                    checkOpen = 0;
                    removed = 0;
                    cnt = 0;
                    for(var i = 1 ; i < 5 ; i++) { //11
                        if (y-i!=-1){
                            if(points[x][y-i]==type) {
                                cnt++;
                            } else if(points[x][y-i]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (y+i!=10){
                            if(points[x][y+i]==type) {
                                cnt++;
                            } else if(points[x][y+i]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[option][option2]+=number*number;
                    }
                    for(var i = removed ; i<5 && y+i!=10 && checkremove ; i++){
                        if (points[x][y+i-4]==type) {
                            cnt--;
                        } else if (points[x][y+i-4]!=0){
                            checkOpen--;
                        }
                        if (points[x][y+i]==type) {
                            cnt++;
                        } else if (points[x][y+i]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[option][option2]+=number*number;
                            }
                        }
                }
                }
                if (check == true) {
                    breakopen = false;
                    break;
                }
            }
            number--
        }
        var returnValues = [number+1];
        var max = 0;
        for( var i = 0 ; i<worth.length ; i++ ){
            for( var j = 0 ; j<worth[i].length ; j++ ){
                if (max<worth[i][j]) {
                    max = worth[i][j];
                }
            }
        }
        var returnValuesValues = [];
        for( var i = 0 ; i<worth.length ; i++ ){
            for( var j = 0 ; j<worth[i].length ; j++ ){
                if (max==worth[i][j]) {
                    returnValuesValues.push([i,j]);
                }
            }
        }
        returnValues.push(returnValuesValues);
        return returnValues;
        
    }
    function bestSide(card,value,offensive){
        var type = value;
        var number = 4;
        var worth = [];
        if (card.length===1) {
            return [0];
        }
        for (var j = 0 ; j<card.length ; j++) {
            worth.push(0);
        }
        var breakopen = true;
        while(number!=-1&&breakopen){    
            for(var side = 0; side<card.length ; side++){
                var x = card[side][0];
                var y = card[side][1];
                
                var check = false;
                
                var checkOpen = 0;
                var checkremove = true;
                var removed = 0;
                var cnt = 0;
                
                for( var blah = 0 ; blah<=1&&breakopen; blah++){
                    if (blah===0) {
                        type = value;
                    } else if (offensive||number<3) {
                        continue;
                    } else if (!offensive) {
                        type=4-value;
                    }
                    for(var i = 1 ; i < 5 ; i++) { //11
                        if (x-i!=-1 && y-i!=-1){
                            if(points[x-i][y-i]==type) {
                                cnt++;
                            } else if(points[x-i][y-i]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (x+i!=10 && y+i!=10){
                            if(points[x+i][y+i]==type) {
                                cnt++;
                            } else if(points[x+i][y+i]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[side]+=number*number;
                    }
                    for(var i = removed ; i<5 && x+i!=10 && y+i!=10 && checkremove ; i++){
                        if (points[x+i-4][y+i-4]==type) {
                            cnt--;
                        } else if (points[x+i-4][y+i-4]!=0){
                            checkOpen--;
                        }
                        if (points[x+i][y+i]==type) {
                            cnt++;
                        } else if (points[x+i][y+i]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[side]+=number*number;
                        }
                    }
                    
                    checkOpen = 0;
                    removed = 0;
                    cnt = 0;
                    for(var i = 1 ; i < 5 ; i++) { //12
                        if (x-i!=-1){
                            if(points[x-i][y]==type) {
                                cnt++;
                            } else if(points[x-i][y]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (x+i!=10){
                            if(points[x+i][y]==type) {
                                cnt++;
                            } else if(points[x+i][y]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[side]+=number*number;
                    }
                    for(var i = removed ; i<5 && x+i!=10 && checkremove ; i++){
                        if (points[x+i-4][y]==type) {
                            cnt--;
                        } else if (points[x+i-4][y]!=0){
                            checkOpen--;
                        }
                        if (points[x+i][y]==type) {
                            cnt++;
                        } else if (points[x+i][y]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[side]+=number*number;
                        }
                    }
                    
                    checkOpen = 0;
                    removed = 0;
                    cnt = 0;
                    for(var i = 1 ; i < 5 ; i++) { //11
                        if (x-i!=-1 && y+i!=10){
                            if(points[x-i][y+i]==type) {
                                cnt++;
                            } else if(points[x-i][y+i]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (x+i!=10 && y-i!=-1){
                            if(points[x+i][y-i]==type) {
                                cnt++;
                            } else if(points[x+i][y-i]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[side]+=number*number;
                    }
                    for(var i = removed ; i<5 && x+i!=10 && y-i!=-1 && checkremove ; i++){
                        if (points[x+i-4][y-i+4]==type) {
                            cnt--;
                        } else if (points[x+i-4][y-i+4]!=0){
                            checkOpen--;
                        }
                        if (points[x+i][y+i]==type) {
                            cnt++;
                        } else if (points[x+i][y-i]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[side]+=number*number;
                        }
                    }
                    checkOpen = 0;
                    removed = 0;
                    cnt = 0;
                    for(var i = 1 ; i < 5 ; i++) { //11
                        if (y-i!=-1){
                            if(points[x][y-i]==type) {
                                cnt++;
                            } else if(points[x][y-i]!=0){
                                checkOpen++;
                            }
                        } else {
                            removed+=5-i;
                            break;
                        }
                    }
                    for(var i = 1 ; i<=removed ; i++){
                        if (y+i!=10){
                            if(points[x][y+i]==type) {
                                cnt++;
                            } else if(points[x][y+i]!=0){
                                checkOpen++;
                            }
                        } else {
                            checkremove = false;
                            break;
                        }
                    }
                    if (cnt==number&&checkOpen==0) {
                        check = true;
                        worth[side]+=number*number;
                    }
                    for(var i = removed ; i<5 && y+i!=10 && checkremove ; i++){
                        if (points[x][y+i-4]==type) {
                            cnt--;
                        } else if (points[x][y+i-4]!=0){
                            checkOpen--;
                        }
                        if (points[x][y+i]==type) {
                            cnt++;
                        } else if (points[x][y+i]!=0){
                            checkOpen++;
                        }
                        if (cnt==number&&checkOpen==0) {
                            check = true;
                            worth[side]+=number*number;
                        }
                    }
                }
                if (check) {
                    breakopen = false;
                    break;
                }
            }
            number--
        }
        
        var returnValues = [];
        var max = 0;
        var maxPos = -1;
        for( var i = 0 ; i<worth.length ; i++ ){
            if (max<worth[i]) {
                max = worth[i];
                maxPos = i;
            }
        }
        var secondMax = 0;
        var secondMaxPos = -1;
        for( var i = 0 ; i<worth.length ; i++ ){
            if (i===maxPos) {
                continue;
            }
            if (secondMax<worth[i]) {
                secondMax = worth[i];
                secondMaxPos = i;
            }
        }
        returnValues.push(max-secondMax);
        returnValues.push(maxPos);
        returnValues.push(secondMaxPos);
        return returnValues;
        
    }

    //checks if lines is won and turns them over
    function checker(x,y){
        var value = points[x][y];
        var tnp = [];
        
        var check11 = true;
        var check12 = true;
        var check13 = true;
        var check21 = true;
        var check23 = true;
        var check31 = true;
        var check32 = true;
        var check33 = true;
        
        var cnt11 = 0;
        var cnt12 = 0;
        var cnt13 = 0;
        var cnt21 = 0;
        
        for(var i = 1 ; i < 5 ; i++) { //check later for edges
            if (x-i!=-1 && x-i!=-1 && check11 && points[x-i][y-i]==value) {
                cnt11++;
                tnp.push([x-i,y-i])
            } else {
                check11 = false;
            }
            if (x+i!=10 && x+i!=10 && check33 && points[x+i][y+i]==value) {
                cnt11++;
                tnp.push([x+i,y+i])
            } else {
                check33 = false;
            }
        }
        if (cnt11>=4) {
            if (value == 1) {
                blueLines++;
            } else if (value == 3){
                greenLines++;
            }
            finishLine(x,y,value);
            for(var i = 0 ; i<4 ; i++){
                finishLine(tnp[i][0],tnp[i][1],value);
            }
        }
        tnp = [];
        for(var i = 1 ; i < 5 ; i++) { //check later for edges
            if (y-i!=-1 && check12 && points[x][y-i]==value) {
                cnt12++;
                tnp.push([x,y-i])
            } else {
                check12 = false;
            }
            if (y+i!=10 && check32 && points[x][y+i]==value) {
                cnt12++;
                tnp.push([x,y+i])
            } else {
                check32 = false;
            }
        }
        if (cnt12>=4) {
            if (value == 1) {
                blueLines++;
            } else if (value == 3){
                greenLines++;
            }
            finishLine(x,y,value);
            for(var i = 0 ; i<4 ; i++){
                finishLine(tnp[i][0],tnp[i][1],value);
            }
        }
        tnp = [];
        for(var i = 1 ; i < 5 ; i++) { //check later for edges
            if (x+i!=10 && y-i!=-1 && check13 && points[x+i][y-i]==value) {
                cnt13++;
                tnp.push([x+i,y-i])
            } else {
                check13 = false;
            }
            if (x-i!=-1 && y+i!=10 && check31 && points[x-i][y+i]==value) {
                cnt13++;
                tnp.push([x-i,y+i])
            } else {
                check31 = false;
            }
        }
        if (cnt13>=4) {
            if (value == 1) {
                blueLines++;
            } else if (value == 3){
                greenLines++;
            }
            finishLine(x,y,value);
            for(var i = 0 ; i<4 ; i++){
                finishLine(tnp[i][0],tnp[i][1],value);
            }
        }
        tnp = [];
        for(var i = 1 ; i < 5 ; i++) { //check later for edges
            if (x-i!=-1 && check21 && points[x-i][y]==value) {
                cnt21++;
                tnp.push([x-i,y])
            } else {
                check21 = false;
            }
            if (x+i!=10 && check23 && points[x+i][y]==value) {
                cnt21++;
                tnp.push([x+i,y])
            } else {
                check23 = false;
            }
        }
        if (cnt21>=4) {
            if (value == 1) {
                blueLines++;
            } else if (value == 3){
                greenLines++;
            }
            finishLine(x,y,value);
            for(var i = 0 ; i<4 ; i++){
                finishLine(tnp[i][0],tnp[i][1],value);
            }
        }
        tnp = [];
    }

    //restart game
    function restart (){
        for (var row = 0 ; row < 10 ; row++) {
            for( var col = 0 ; col< 10 ; col++)
            {
                points[row][col]=0;
            }
        }
        shuffle(deck);
        
        var player1 = [];
        var player2 = [];
        var player3 = [];
        var player4 = [];
        for (var i = 97 ; i < 104 ; i++)
        {
            player1.push(deck[i]);
        }
        for (var i = 90 ; i < 97 ; i++)
        {
            player2.push(deck[i]);
        }
        for (var i = 83 ; i < 90 ; i++)
        {
            player3.push(deck[i]);
        }
        for (var i = 76 ; i < 83 ; i++)
        {
            player4.push(deck[i]);
        }
        players = [player1.slice(),player2.slice(),player3.slice(),player4.slice()];
        showHands();
        
        for(var i = 1 ; i<=100 && animate; i++)
        {
            $('#'+i).removeClass();
            $('#'+i).addClass('v0');
        }
        currentPlayer = 0;
        pastPlayer = -1;
        pastCardIndex = -1;
        pastCard = -2;
        if (animate) {
            $('#card_played').empty();
        }
        cardsplayed = [];
        cardsleft = 75;
        blueLines = 0;
        greenLines = 0;
    }
    
    
    //shuffle deck
    function shuffle(array) {
        var currentIndex = array.length, temporaryValue, randomIndex ;
      
        // While there remain elements to shuffle...
        while (0 !== currentIndex) {
      
          // Pick a remaining element...
          randomIndex = Math.floor(Math.random() * currentIndex);
          currentIndex -= 1;
      
          // And swap it with the current element.
          temporaryValue = array[currentIndex];
          array[currentIndex] = array[randomIndex];
          array[randomIndex] = temporaryValue;
        }
      
        return array;
    }
    function sort_arrays(a,b) {
        if (a[0] < b[0]) return -1;
        if (a[0] > b[0]) return 1;
        if (a[1] < b[1]) return -1;
        if (a[1] > b[1]) return 1;
        return 0;
    }
    function sort_by_number(a,b) {
        if (a[2] < b[2]) return -1;
        if (a[2] > b[2]) return 1;
        return 0;
    }

    //has an Add J
    function hasAdd(player){
        for (var i = 0 ; i < player.length ; i++){
            if (player[i] == 0) {
                return i;
            }
        }
        return -1;
    }

    //has a Remove J
    function hasRemove(player) {
        for (var i = 0 ; i < player.length ; i++){
            if (player[i]==-1) {
                return i;
            }
        }
        return -1;
    }
    function hasOnlyJ(player) {
        for (var i = 0 ; i < player.length ; i++){
            if (player[i]!=-1&&player[i]!=0) {
                return false;
            }
        }
        return true;
    }
    function hasOnlyRemoveJ(player) {
        for (var i = 0 ; i < player.length ; i++){
            if (player[i]!=-1) {
                return false;
            }
        }
        return true;
    }

    //has a useless card
    function hasUselessCard(options) {
        for (var i = 0 ; i < options.length ; i++){
            if (options[i].length==0) {
                return i;
            }
        }
        return false;
    }

    //changes a value to 0 because of remove J
    function value0(x,y) {
        points[x][y] = 0;
            var position = 10*x+y+1;
            if (animate) {
            $('#'+position).removeClass();
            $('#'+position).addClass('v0');
            }
    }

    //changes value to given value of card played
    function changeValue(x,y,value) {
        points[x][y] = value;
            var position = 10*x+y+1;
            if (animate) {
            $('#'+position).removeClass('v0');
            $('#'+position).addClass('v'+value);
            }
    }

    //creates a line
    function finishLine(x,y,value){
        points[x][y] = value+1;
        pointworth[x][y]++;
            var position = 10*x+y+1;
            if (animate) {
            $('#'+position).removeClass('v'+value);
            $('#'+position).addClass('v'+(value+1));
            }
    }

    //shows Hand on board
    function showHands(){
        $("#p0").empty();
        $("#p1").empty();
        $("#p2").empty();
        $("#p3").empty();
        for (var i = 0 ; i<players.length ; i++) {
            for (var j = 0 ; j<players[i].length ; j++) {
                $("#p"+i).append("<div id='p"+i+"_"+j+"'>"+changeToCards(players[i][j])+"</div>");
            }
        }
    }
    var pastRemove = true;
    var pastPlayer = -1;
    var pastCardIndex = -1;
    var pastCard = -2;
    var pastChange = false;
    function animateHand(index,player,remove,change){
        if (pastPlayer!==-1){
            if (!pastRemove) {
                if (!pastChange) {
                    $('#p'+pastPlayer+'_'+pastCardIndex).removeClass('raise');
                    $('#p'+pastPlayer+'_'+pastCardIndex).html(changeToCards(pastCard));
                }
            } else {
                $('#p'+pastPlayer+'_'+pastCardIndex).removeClass('raise');
                size = players[pastPlayer].length;
                $('#p'+pastPlayer+'_'+size).remove();
                for ( var i = pastCardIndex ; i < size ; i++) {
                    $('#p'+pastPlayer+'_'+i).html(changeToCards(players[pastPlayer][i]));
                }
            }
            
        }
        if (!change) {
            $('#p'+player+'_'+index).addClass('raise');
        } else {
            $('#p'+player+'_'+index).html(changeToCards(players[player][index]));
        }
        pastCard = players[player][index];
        pastCardIndex = index;
        pastPlayer = player;
        pastRemove = remove;
        pastChange = change;
    }
    function showWorth() {
        for(var x = 0 ; x<10; x++)
        {
            for(var y = 0 ; y<10; y++)
            {
                i=x*10+y+1;
                $('#'+i).removeClass();
                $('#'+i).addClass('v0');
                $('#'+i).text(pointworth[x][y]);
            }
        }
        showArray(pointworth,"#values");
    }
    function showArray(data,container){
        if (Array.isArray(data)) {
            $(container).append('[');
            for(var i = 0 ; i<data.length ; i++) {
                showArray(data[i],container);
                if (i!=data.length-1) {
                    $(container).append(',');
                }
            }
            $(container).append(']');
        } else if (typeof data.getMonth === 'function') {
            $(container).append('new Date("'+data+'")');
        } else if (typeof data === 'string') {
            $(container).append('"'+data+'"');
        } else {
            $(container).append(data);
        }
    }
    function hideHands(player) {
        for (var i = 0 ; i<players.length ; i++)
        {
            if (i == player) {
                continue;
            }
            for (var j = 0 ; j<players[i].length; j++) {
                $('#p'+i+'_'+j).addClass('hide');
            }
        }
    }
    function changeToCards(number) {
        switch (number) {
            case -1:
                return "J -";
            case 0:
                return "J +";
            case 1:
                return "&#9734";
            case 2:
                return "10 &#9825";
            case 3:
                return "9 &#9825";
            case 4:
                return "8 &#9825";
            case 5:
                return "7 &#9825";
            case 6:
                return "7 &#9827";
            case 7:
                return "8 &#9827";
            case 8:
                return "9 &#9827";
            case 9:
                return "10 &#9827";
            case 10:
                return "10 &#9824";
            case 11:
                return "K &#9825";
            case 12:
                return "6 &#9825";
            case 13:
                return "5 &#9825";
            case 14:
                return "4 &#9825";
            case 15:
                return "4 &#9827";
            case 16:
                return "5 &#9827";
            case 17:
                return "6 &#9827";
            case 18:
                return "K &#9827";
            case 19:
                return "10 &#9671";
            case 20:
                return "9 &#9824";
            case 21:
                return "6 &#9824";
            case 22:
                return "Q &#9825";
            case 23:   
                return "3 &#9825";
            case 24:   
                return "2 &#9825";
            case 25:   
                return "2 &#9827";
            case 26:   
                return "3 &#9827";
            case 27:   
                return "Q &#9827";
            case 28:   
                return "6 &#9671";
            case 29:
                return "9 &#9671";
            case 30:
                return "8 &#9824";
            case 31:
                return "5 &#9824";
            case 32:
                return "3 &#9824";
            case 33:
                return "Q &#9824";
            case 34:
                return "A &#9825";
            case 35:
                return "A &#9827";
            case 36:
                return "Q &#9671";
            case 37:
                return "3 &#9671";
            case 38:
                return "5 &#9671";
            case 39:
                return "8 &#9671";
            case 40:
                return "7 &#9824";
            case 41:  
                return "4 &#9824";
            case 42:  
                return "2 &#9824";
            case 43:  
                return "A &#9824";
            case 44:  
                return "K &#9824";
            case 45:  
                return "K &#9671";
            case 46:  
                return "A &#9671";
            case 47:  
                return "2 &#9671";
            case 48:  
                return "4 &#9671";
            case 49:  
                return "7 &#9671";
            default:
                return "-2";
        }
    }
    
});
</script>
</body>
</html>
