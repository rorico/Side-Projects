<!DOCTYPE html>

<html>
<head>
    <title>Page Title</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
</head>
<body>
<p>
<textarea rows="30" cols="180" id="input" ></textarea><br />
<input type="button" value="convert" id="convert" />
</p>

<script type="text/javascript">
    $("#convert").click(function(){
    	var info = $('#input').val();
    	$('p').empty();
    	showArray(parseData(info));
    })
    function parseData(text) {
    	var info = [];
    	var beginning = "University of Waterloo";
    	var end = "Printer Friendly Page";
        var classTypes = ["SEM","TUT","LAB","LEC"];
        var content = text.substring(text.indexOf(beginning) + beginning.length,text.indexOf(end));
        var courses = content.split("Exam Information");
        for (var i = 0 ; i < courses.length ; i++) {
            var courseInfo = [];
            var lines = courses[i].split("\n");
            var courseName=[];
            var type = "";
            var index = 0;
            for (var j = 0 ; j < lines.length ; j++){
            	var line = lines[j];
            	if (/^[A-Z].+$/.test(line)){
					var courseParts = line.split(" ");
		            var courseCode = courseParts[0] + " " + courseParts[1];
		            var courseDescription = "";
		            for (var word = 2 ; word < courseParts.length - 1 ; word++) {
		                courseDescription += courseParts[word]+" ";
		            }
		            courseDescription += courseParts[courseParts.length - 1];
		            courseName = [courseCode,courseDescription];
		            break;
            	}
            }
            for (var j = 0 ; j < lines.length ; j++) {
            	for(var k = 0 ; k < classTypes.length ; k++) {
            		if (lines[j] == classTypes[k]){
            			type = classTypes[k];
            			break;
            		}
            	}
                if (/^[MTWTFh]{1,6} \d{1,2}:.+$/.test(lines[j])) {
                    courseInfo.push([getClassLength(lines[j]),lines[j+1],lines[j+2],parseDate(lines[j+3]),courseName,type])
                    j+=4;
                }
            }
            info.push(courseInfo);
        }
        return info;
    }
    function parseDate(date) {
        var returnValues = [];
        var dates = date.split(" - ");
        for (var i = 0 ; i < dates.length ; i++) {
            var dateparts = dates[i].split("/");
            //MM/DD/YYYY
            if (i==1) {
                returnValues.push(new Date(dateparts[2],dateparts[0]-1,dateparts[1],23,59,59,999));
            } else {
                returnValues.push(new Date(dateparts[2],dateparts[0]-1,dateparts[1]));
            }
        }
        return returnValues;
    }
    function getClassLength(range) {
        words = range.split(" ");
        startValue = parseTime(words[1]);
		endValue = parseTime(words[3]);
        return [words[0],startValue,endValue];
    }
    function parseTime(time){
		timeParts = time.split(":");
        timeHour = timeParts[0];
        timeValue = timeHour * 100;
        if (timeParts[1].indexOf("PM")>-1&&timeParts[0]!="12") {
            timeValue+=1200;
        }
        timeParts[1]=timeParts[1].slice(0,-2); //remove pm/am
        timeValue+=((timeParts[1])/(0.6));
        return timeValue;
    }
    function showArray(data){
        if (Array.isArray(data)) {
            $('p').append('[');
            for(var i = 0 ; i<data.length ; i++) {
                showArray(data[i]);
                if (i!=data.length-1) {
                    $('p').append(',');
                }
            }
            $('p').append(']');
        } else if (typeof data.getMonth === 'function') {
            $('p').append('new Date("'+data+'")');
        } else if (typeof data === 'string') {
            $('p').append('"'+data+'"');
        } else {
            $('p').append(data);
        }
    }
</script>
</body>
</html>
