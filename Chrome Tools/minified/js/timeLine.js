var currentTimePiece=-1,timeLineInit,countDown,addTimeLine,changeTimeLine,restartTimeLine,newPage,keyPhrases;!function(){function e(e){return e-B}function i(i){return i===-2?"timeLineP":"timeLine"+e(i)}function t(e,i){e.click(function(){currentTimePiece=i+B,n(currentTimePiece)}),e.hover(function(){n(i+B)},function(){n(currentTimePiece)})}function n(e,i){clearTimeout(x);var t="";if(e===-1){p=new Date-L;var a=1e3-p%1e3;i?$("#timeSpend").html(c(p,!0)):(t=o(w,p,g),$("#info").html(t)),x=setTimeout(function(){n(e,!0)},a)}else t=o(P[e][2],P[e][0],P[e][3]),$("#info").html(t)}function a(e){if($("#timeLeft").html(c(e,!1)),T&&e>0){var i=(e-1)%1e3+1;M=setTimeout(function(){a(e-i)},i)}}function r(){var e=k/D;b=setInterval(function(){var e=$("#timeLine div:last-child");e.width(e.width()+1),!e.hasClass("timeLineBlock")&&e.width()>=3&&e.addClass("timeLineBlock");for(var i=$("#timeLine div:first-child");i.length&&i.width()<=0;)i.remove(),i=$("#timeLine div:first-child");i.width(i.width()-1),i.hasClass("timeLineBlock")&&i.width()<3&&i.removeClass("timeLineBlock")},e)}function o(e,i,t){return"<div class='ellipsis'>"+t+"</div><div class='ellipsis'>"+e+"</div>Time spent: <span id='timeSpend'>"+c(i,!0)+"</span>"}function c(e,i){var t=i?Math.floor(e/1e3):Math.ceil(e/1e3);return Math.floor(t/60)+":"+("0"+Math.floor(t%60)).slice(-2)}function s(){v("resetTime")}function m(){v("VIP")}function d(){v("change",currentTimePiece)}function l(){v("temp")}function u(){v("zero")}function f(){v("antizero")}function v(e,i){chrome.runtime.sendMessage({from:"browserAction",action:e,input:i})}var h,L,T,w,g,p,P,k,M=-1,D=360,I=D,C=0,B=0,b=-1,x=-1;keyPhrases=[["ZYXWVUTSRQPONMLKJIHGFEDCBA",s],["VIP",m,1],["CHANGE",d],["TEMP",l],["NO",u],["MO",f,1]],timeLineInit=function(e,i){var t=e.width()-30;D=60*Math.floor(t/60);for(var a="<div id='axisTop'>",c="<div id='axisBot'>",s=0;s<6;s++)a+="<div class='axisPart top"+(5===s?" end":"")+"'></div>",c+="<div class='axisPart bot"+(5===s?" end":"")+"'></div>";a+="</div>",c+="</div>";var m="<div id='chromeTools_timeLine'><div id='timeLeft'></div><div id='timeLineHolder'>"+a+"<div id='timeLine'></div>"+c+"</div><div id='info'></div></div>";if(e.html(m),$(".axisPart").outerWidth(D/6),h=i.timeLeft,L=i.startTime,T=i.wastingTime,w=i.url,g=i.title,p=new Date-L,M=-1,countDown(h),I=D,C=0,B=0,clearInterval(b),clearInterval(x),$("#info").html(o(w,p,g)),P=JSON.parse(JSON.stringify(i.timeLine)),k=i.timeLineLength,addTimeLine(-1,!1,p,T)){for(var s=0;s<P.length&&addTimeLine(s,!1,P[s][0],P[s][1]);s++);addTimeLine(-2,!1)}n(-1),r();var d=(e.innerHeight()-$("#chromeTools_timeLine").outerHeight())/2;$("#chromeTools_timeLine").css("top",d)},restartTimeLine=function(e){clearInterval(b),clearInterval(x),h=e.timeLeft,L=e.startTime,T=e.wastingTime,w=e.url,g=e.title,p=new Date-L,$("#info").html(o(w,p,g)),I=D,currentTimePiece=-1,C=0,$("#timeLine").empty(),addTimeLine(-1,!1,p,T),addTimeLine(-2,!1),n(-1),r()},addTimeLine=function(n,a,r,o){var c=0;if(c=n===-2?I:r/k*D+C,C=c%1,c=Math.floor(c),c<1&&n!==-1)return C+=c,!0;var s=!0;c>=I?(c=I,I=0,s=!1):I-=c;var m="timeLine";n!==-2&&(m+=" wasting"+o,c>=3&&(m+=" timeLineBlock"));var d=$("<div style='width:"+c+"px;' class='"+m+"' id='"+i(n)+"'></div>");return a?$("#timeLine").append(d):$("#timeLine").prepend(d),n!==-2&&t(d,e(n)),s},changeTimeLine=function(e,t){$("#"+i(e)).removeClass("wasting"+t).addClass("wasting0")},newPage=function(e){L=e.startTime,T=e.wastingTime,w=e.url,g=e.title,P.unshift(e.newest),B++,addTimeLine(-1,!0,new Date-L,T),n(-1)},countDown=function(e){T&&(e-=new Date-L),e<0&&(e=0),clearTimeout(M),a(e)},chrome.runtime.onMessage.addListener(function(e,i,t){if("background"===e.from)switch(e.action){case"timer":countDown(e.input);break;case"change":var n=e.input;changeTimeLine(n[0],n[1]);break;case"reset":restartTimeLine(e.input);break;case"newPage":newPage(e.input)}})}();