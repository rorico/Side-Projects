var timeLineInit,timeLineResize;!function(){function i(i,n){O=e(i.width());for(var a="<div id='axisTop'>",r="<div id='axisBot'>",o=0;o<6;o++)a+="<div class='axisPart top"+(5===o?" end":"")+"'></div>",r+="<div class='axisPart bot"+(5===o?" end":"")+"'></div>";a+="</div>",r+="</div>";var s="<div id='"+D+"'><div id='timeLeft'></div><div id='timeLineHolder'>"+a+"<div id='timeLine'></div>"+r+"</div><div id='info'></div></div>";return i.append(s),$(".axisPart").outerWidth(O/6),M=n.timeLeft,C=n.startTime,x=n.wastingTime,B=n.url,I=n.title,f(M),z=n.timeLineLength,y=JSON.parse(JSON.stringify(n.timeLine)),t(),addPhrases(keyPhrases),timeLineResize=function(){var n=e(i.width());n!==O&&(O=n,$(".axisPart").outerWidth(O/6),$("#timeLine").empty(),t())},$(window).resize(timeLineResize),$("#"+D)}function e(i){return 60*Math.floor((i-30)/60)}function t(){if(S=O,R=0,A=-1,E=0,b=new Date-C,a(-1,!1,b,x)){for(var i=0;i<y.length&&a(i,!1,y[i][0],y[i][1]);i++);a(-2,!1)}d(-1),l()}function n(i){M=i.timeLeft,C=i.startTime,x=i.wastingTime,B=i.url,I=i.title,b=new Date-C,y=[],$("#timeLine").empty(),t()}function a(i,e,t,n){var a=0;if(a=i===-2?S:t/z*O+R,R=a%1,a=Math.floor(a),a<1&&i!==-1)return R+=a,!0;var d=!0;a>=S?(a=S,S=0,d=!1):S-=a;var c="timeLine";i!==-2&&(c+=" wasting"+n,a>=3&&(c+=" timeLineBlock"));var m=$("<div style='width:"+a+"px;' class='"+c+"' id='"+o(i)+"'></div>");return e?$("#timeLine").append(m):$("#timeLine").prepend(m),i!==-2&&s(m,r(i)),d}function r(i){return i-E}function o(i){return i===-2?"timeLineP":"timeLine"+r(i)}function s(i,e){i.click(function(){A=e+E,d(A)}),i.hover(function(){d(e+E)},function(){d(A)})}function d(i,e){clearTimeout(J);var t="";if(i===-1){b=new Date-C;var n=1e3-b%1e3;e?$("#timeSpend").html(h(b,!0)):(t=v(B,b,I),$("#info").html(t)),J=setTimeout(function(){d(i,!0)},n)}else t=v(y[i][2],y[i][0],y[i][3]),$("#info").html(t)}function c(i,e){$("#"+o(i)).removeClass("wasting"+e).addClass("wasting0")}function m(i){C=i.startTime,x=i.wastingTime,B=i.url,I=i.title,y.unshift(i.newest),E++,a(-1,!0,new Date-C,x),d(-1)}function f(i){x&&(i-=new Date-C),i<0&&(i=0),clearTimeout(N),u(i)}function u(i){if($("#timeLeft").html(h(i,!1)),x&&i>0){var e=(i-1)%1e3+1;N=setTimeout(function(){u(i-e)},e)}}function l(){clearInterval(H);var i=z/O;H=setInterval(function(){var i=$("#timeLine div:last-child");i.width(i.width()+1),!i.hasClass("timeLineBlock")&&i.width()>=3&&i.addClass("timeLineBlock");for(var e=$("#timeLine div:first-child");e.length&&e.width()<=0;)e.remove(),e=$("#timeLine div:first-child");e.width(e.width()-1),e.hasClass("timeLineBlock")&&e.width()<3&&e.removeClass("timeLineBlock")},i)}function v(i,e,t){return"<div class='ellipsis'>"+t+"</div><div class='ellipsis'>"+i+"</div>Time spent: <span id='timeSpend'>"+h(e,!0)+"</span>"}function h(i,e){var t=e?Math.floor(i/1e3):Math.ceil(i/1e3);return Math.floor(t/60)+":"+("0"+Math.floor(t%60)).slice(-2)}function L(){k("resetTime")}function w(){k("VIP")}function p(){k("change",A)}function g(){k("temp")}function T(){k("zero")}function P(){k("antizero")}function k(i,e){chrome.runtime.sendMessage({from:"browserAction",action:i,input:e})}var M,C,x,B,I,b,y,z,D="chromeTools_timeLine",N=-1,O=360,S=O,R=0,A=-1,E=0,H=-1,J=-1;keyPhrases=[["ZYXWVUTSRQPONMLKJIHGFEDCBA",L],["VIP",w,1],["CHANGE",p],["TEMP",g],["NO",T],["MO",P,1]],timeLineInit=i,chrome.runtime.onMessage.addListener(function(i,e,t){if("background"===i.from)switch(i.action){case"timer":f(i.input);break;case"change":var a=i.input;c(a[0],a[1]);break;case"reset":n(i.input);break;case"newPage":m(i.input)}})}();