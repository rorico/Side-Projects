var timeLineInit,keyPhrases;!function(){function i(i){return 60*Math.floor((i-30)/60)}function e(){if(N=H,O=0,S=-1,z=0,I=new Date-M,n(-1,!1,I,C)){for(var i=0;i<b.length&&n(i,!1,b[i][0],b[i][1]);i++);n(-2,!1)}s(-1),u()}function t(i){P=i.timeLeft,M=i.startTime,C=i.wastingTime,x=i.url,B=i.title,I=new Date-M,b=[],$("#timeLine").empty(),e()}function n(i,e,t,n){var s=0;if(s=i===-2?N:t/y*H+O,O=s%1,s=Math.floor(s),s<1&&i!==-1)return O+=s,!0;var c=!0;s>=N?(s=N,N=0,c=!1):N-=s;var d="timeLine";i!==-2&&(d+=" wasting"+n,s>=3&&(d+=" timeLineBlock"));var m=$("<div style='width:"+s+"px;' class='"+d+"' id='"+a(i)+"'></div>");return e?$("#timeLine").append(m):$("#timeLine").prepend(m),i!==-2&&o(m,r(i)),c}function r(i){return i-z}function a(i){return i===-2?"timeLineP":"timeLine"+r(i)}function o(i,e){i.click(function(){S=e+z,s(S)}),i.hover(function(){s(e+z)},function(){s(S)})}function s(i,e){clearTimeout(E);var t="";if(i===-1){I=new Date-M;var n=1e3-I%1e3;e?$("#timeSpend").html(v(I,!0)):(t=l(x,I,B),$("#info").html(t)),E=setTimeout(function(){s(i,!0)},n)}else t=l(b[i][2],b[i][0],b[i][3]),$("#info").html(t)}function c(i,e){$("#"+a(i)).removeClass("wasting"+e).addClass("wasting0")}function d(i){M=i.startTime,C=i.wastingTime,x=i.url,B=i.title,b.unshift(i.newest),z++,n(-1,!0,new Date-M,C),s(-1)}function m(i){C&&(i-=new Date-M),i<0&&(i=0),clearTimeout(D),f(i)}function f(i){if($("#timeLeft").html(v(i,!1)),C&&i>0){var e=(i-1)%1e3+1;D=setTimeout(function(){f(i-e)},e)}}function u(){clearInterval(A);var i=y/H;A=setInterval(function(){var i=$("#timeLine div:last-child");i.width(i.width()+1),!i.hasClass("timeLineBlock")&&i.width()>=3&&i.addClass("timeLineBlock");for(var e=$("#timeLine div:first-child");e.length&&e.width()<=0;)e.remove(),e=$("#timeLine div:first-child");e.width(e.width()-1),e.hasClass("timeLineBlock")&&e.width()<3&&e.removeClass("timeLineBlock")},i)}function l(i,e,t){return"<div class='ellipsis'>"+t+"</div><div class='ellipsis'>"+i+"</div>Time spent: <span id='timeSpend'>"+v(e,!0)+"</span>"}function v(i,e){var t=e?Math.floor(i/1e3):Math.ceil(i/1e3);return Math.floor(t/60)+":"+("0"+Math.floor(t%60)).slice(-2)}function h(){k("resetTime")}function L(){k("VIP")}function w(){k("change",S)}function p(){k("temp")}function g(){k("zero")}function T(){k("antizero")}function k(i,e){chrome.runtime.sendMessage({from:"browserAction",action:i,input:e})}var P,M,C,x,B,I,b,y,D=-1,H=360,N=H,O=0,S=-1,z=0,A=-1,E=-1;keyPhrases=[["ZYXWVUTSRQPONMLKJIHGFEDCBA",h],["VIP",L,1],["CHANGE",w],["TEMP",p],["NO",g],["MO",T,1]],timeLineInit=function(t,n){H=i(t.width());for(var r="<div id='axisTop'>",a="<div id='axisBot'>",o=0;o<6;o++)r+="<div class='axisPart top"+(5===o?" end":"")+"'></div>",a+="<div class='axisPart bot"+(5===o?" end":"")+"'></div>";r+="</div>",a+="</div>";var s="<div id='chromeTools_timeLine'><div id='timeLeft'></div><div id='timeLineHolder'>"+r+"<div id='timeLine'></div>"+a+"</div><div id='info'></div></div>";t.html(s),$(".axisPart").outerWidth(H/6),P=n.timeLeft,M=n.startTime,C=n.wastingTime,x=n.url,B=n.title,m(P),y=n.timeLineLength,b=JSON.parse(JSON.stringify(n.timeLine)),e();var c=(t.innerHeight()-$("#chromeTools_timeLine").outerHeight())/2;$("#chromeTools_timeLine").css("top",c),$(window).resize(function(){var n=i(t.width());n!==H&&(H=n,$(".axisPart").outerWidth(H/6),$("#timeLine").empty(),e())})},chrome.runtime.onMessage.addListener(function(i,e,n){if("background"===i.from)switch(i.action){case"timer":m(i.input);break;case"change":var r=i.input;c(r[0],r[1]);break;case"reset":t(i.input);break;case"newPage":d(i.input)}})}();