var timeLineInit,timeLineResize,timeLineUpdate;!function(){function i(i,a){H=e(i.width());for(var o="<div id='axisTop'>",r="<div id='axisBot'>",s=0;s<6;s++)o+="<div class='axisPart top"+(5===s?" end":"")+"'></div>",r+="<div class='axisPart bot"+(5===s?" end":"")+"'></div>";o+="</div>",r+="</div>";var d="<div id='"+S+"'><div id='timeLeft'></div><div id='timeLineHolder'>"+o+"<div id='timeLine'></div>"+r+"</div><div id='info'></div></div>";i.append(d),$(".axisPart").outerWidth(H/6),O=a.timeLineLength,t(a),m(b),addPhrases(keyPhrases),timeLineResize=function(){var t=e(i.width());t!==H&&(H=t,$(".axisPart").outerWidth(H/6),$("#timeLine").empty(),n())},$(window).resize(timeLineResize)}function e(i){return 60*Math.floor((i-30)/60)}function t(i){b=i.timeLeft,x=i.startTime,y=i.wastingTime,B=i.url,z=i.title,D=new Date-x,N=i.timeLine?JSON.parse(JSON.stringify(i.timeLine)):[],$("#timeLine").empty(),n()}function n(){if(R=H,E=0,J=-1,U=0,D=new Date-x,a(-1,!1,D,y)){for(var i=0;i<N.length&&a(i,!1,N[i][0],N[i][1]);i++);a(-2,!1)}d(-1),l()}function a(i,e,t,n){var a=0;if(a=i===-2?R:t/O*H+E,E=a%1,a=Math.floor(a),a<1&&i!==-1)return E+=a,!0;var d=!0;a>=R?(a=R,R=0,d=!1):R-=a;var c="timeLine";i!==-2&&(c+=" wasting"+n,a>=3&&(c+=" timeLineBlock"));var f=$("<div style='width:"+a+"px;' class='"+c+"' id='"+r(i)+"'></div>");return e?$("#timeLine").append(f):$("#timeLine").prepend(f),i!==-2&&s(f,o(i)),d}function o(i){return i-U}function r(i){return i===-2?"timeLineP":"timeLine"+o(i)}function s(i,e){i.click(function(){J=e+U,d(J)}),i.hover(function(){d(e+U)},function(){d(J)})}function d(i,e){clearTimeout(W);var t="";if(i===-1){D=new Date-x;var n=1e3-D%1e3;e?$("#timeSpend").html(h(D,!0)):(t=v(B,D,z),$("#info").html(t)),W=setTimeout(function(){d(i,!0)},n)}else t=v(N[i][2],N[i][0],N[i][3]),$("#info").html(t)}function c(i,e){$("#"+r(i)).removeClass("wasting"+e).addClass("wasting0")}function f(i){x=i.startTime,y=i.wastingTime,B=i.url,z=i.title,N.unshift(i.newest),U++,a(-1,!0,new Date-x,y),d(-1)}function m(i){y&&(i-=new Date-x),i<0&&(i=0),clearTimeout(A),u(i)}function u(i){if($("#timeLeft").html(h(i,!1)),y&&i>0){var e=(i-1)%1e3+1;A=setTimeout(function(){u(i-e)},e)}}function l(){clearInterval(V);var i=O/H;V=setInterval(function(){var i=$("#timeLine div:last-child");i.width(i.width()+1),!i.hasClass("timeLineBlock")&&i.width()>=3&&i.addClass("timeLineBlock");for(var e=$("#timeLine div:first-child");e.length&&e.width()<=0;)e.remove(),e=$("#timeLine div:first-child");e.width(e.width()-1),e.hasClass("timeLineBlock")&&e.width()<3&&e.removeClass("timeLineBlock")},i)}function v(i,e,t){return"<div class='ellipsis'>"+t+"</div><div class='ellipsis'>"+i+"</div>Time spent: <span id='timeSpend'>"+h(e,!0)+"</span>"}function h(i,e){var t=e?Math.floor(i/1e3):Math.ceil(i/1e3);return Math.floor(t/60)+":"+("0"+Math.floor(t%60)).slice(-2)}function L(){C("resetTime")}function p(){C("VIP")}function w(){C("finish")}function g(){C("change",J)}function P(){C("temp")}function T(){C("zero")}function k(){C("antizero")}function M(){C("youtube")}function I(){C("skipAd")}function C(i,e){chrome.runtime.sendMessage({from:"browserAction",action:i,input:e})}var b,x,y,B,z,D,N,O,S="chromeTools_timeLine",A=-1,H=360,R=H,E=0,J=-1,U=0,V=-1,W=-1;keyPhrases=[["ZYXWVUTSRQPONMLKJIHGFEDCBA",L],["VIP",p,18],["FINISH",w,10],["CHANGE",g,6],["TEMP",P],["NO",T],["MO",k,8],["O",I],["P",M]],timeLineInit=i,timeLineUpdate=t,chrome.runtime.onMessage.addListener(function(i,e,n){if("background"===i.from)switch(i.action){case"timer":m(i.input);break;case"change":var a=i.input;c(a[0],a[1]);break;case"reset":t(i.input);break;case"newPage":f(i.input)}})}();