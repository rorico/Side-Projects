chrome.runtime.getBackgroundPage(function(e){function i(){if(y){var e=$("<div id='logHolder' class='block'>!</div>");$("body").prepend(e),e.width(e.height()),e.one("click",n)}}function n(){for(var e=$("<div id='logs'></div>"),n=0;n<T.length;n++)if(!T[n][1]){var o=$("<div class='log block'>"+T[n][0]+"</div>");t(o,n),e.append(o)}var r=$("#logHolder");r.html(e),r.outerWidth($("body").width()-20),r.one("click",function(){this.remove(),i()})}function t(e,i){e.click(function(e){e.stopPropagation(),this.remove(),m("removeLog",i),y--,y||$("#logHolder").remove()})}function o(){var e=+$("#setTimer").val();l(e)}function r(e){var i=new Date;i-L<1e3?(D+=e.toFixed(0),D.length>3&&(D=D.substring(1)),$("#setTimer").val(D)):(D=e,$("#setTimer").val(D)),L=new Date}function a(){l(+$("#setTimer").val())}function l(e){m("setAlarm",e)}function c(e){var i=e-1;i>=0&&i<5&&m("removeAlarm",i)}function s(){m("stopAllAlarms")}function d(){m("snooze")}function m(e,i){chrome.runtime.sendMessage({from:"browserAction",action:e,input:i})}function u(e,i,n){var t=e.toLocaleTimeString(),o=i+1;$("#alarmText"+o).html("Alarm at "+t),$("#alarm"+o).removeClass("notSet").css({color:b[n],"border-color":b[n]}).bind("click",function(){c(o)})}function v(e,i){var n=e+1;$("#alarmText"+n).html("Not Set"),$("#alarm"+n).addClass("notSet").unbind("click").css({color:k,"border-color":k,visibility:"visible"}),clearInterval(g[e])}function f(e){var i="hidden";g[e]=setInterval(function(){i="hidden"===i?"visible":"hidden",$("#alarmText"+(e+1)).css("visibility",i)},300)}for(var g=[0,0,0,0,0],h=e,b=e.typeColors,k=e.defaultColor,p=h.alarms,w=0;w<p.length;w++)1==p[w][0]?u(p[w][1],w,p[w][3]):2==p[w][0]&&(u(p[w][1],w,p[w][3]),f(w));timeLineInit($("#timeLineH"),h),keyPressInit($("body"),keyPhrases);var A=[["S",a],["A",s],["X",d]];addPhrases(A),addNumberListener(c,"D"),addNumberListener(r);var T=h.allLogs,y=h.numUnread;i(),setTimeout(function(){window.close()},6e4),$("#timerButton").click(o);var L=new Date,D="";chrome.runtime.onMessage.addListener(function(e,i,n){if("background"===e.from)switch(e.action){case"setAlarm":var t=e.input;u(new Date(t[1]),t[0],t[2]);break;case"removeAlarm":var t=e.input;v(t[0],t[1]);break;case"ringing":f(e.input)}})});